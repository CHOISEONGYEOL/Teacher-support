<!DOCTYPE html>
<html lang="ko" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³µì‚¬í‰í˜• í€´ì¦ˆ - ì£¼ê´€ì‹</title>
    <script src="../theme.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-tertiary: #0f3460;
            --text-primary: #fff;
            --text-secondary: #aaa;
            --text-muted: #888;
            --card-bg: rgba(255,255,255,0.05);
            --card-bg-hover: rgba(255,255,255,0.12);
            --item-bg: rgba(255,255,255,0.08);
            --border-color: rgba(255,255,255,0.1);
            --input-text: #fff;
        }

        [data-theme="light"] {
            --bg-primary: #f5f7fa;
            --bg-secondary: #e8ecf1;
            --bg-tertiary: #dce3eb;
            --text-primary: #1a1a1a;
            --text-secondary: #333333;
            --text-muted: #555555;
            --card-bg: rgba(255,255,255,0.9);
            --card-bg-hover: rgba(255,255,255,0.98);
            --item-bg: rgba(0,0,0,0.06);
            --border-color: rgba(0,0,0,0.15);
            --input-text: #1a1a1a;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 50%, var(--bg-tertiary) 100%);
            min-height: 100vh;
            color: var(--text-primary);
            padding: 20px;
            transition: background 0.3s, color 0.3s;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .back-btn {
            background: var(--item-bg);
            border: none;
            color: var(--text-secondary);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .back-btn:hover {
            background: var(--card-bg-hover);
            color: var(--text-primary);
        }

        h1 {
            text-align: center;
            font-size: 1.8rem;
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .mode-badge {
            background: rgba(39, 174, 96, 0.2);
            border: 1px solid #27ae60;
            color: #27ae60;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
        }

        .stat {
            background: var(--item-bg);
            padding: 10px 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #27ae60;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .energy-diagram {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
        }

        .section {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.1rem;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title.solar { color: #f39c12; border-color: #f39c12; }
        .section-title.surface { color: #27ae60; border-color: #27ae60; }
        .section-title.atmosphere { color: #3498db; border-color: #3498db; }

        .icon { font-size: 1.3rem; }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
        }

        .item {
            background: var(--item-bg);
            border-radius: 12px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .item:hover { background: var(--card-bg-hover); }

        .item-name { font-size: 0.85rem; color: var(--text-secondary); }

        .item-value {
            font-size: 1.2rem;
            font-weight: bold;
            min-width: 50px;
            text-align: right;
        }

        .item-value.unknown {
            background: rgba(39, 174, 96, 0.3);
            border: 2px solid #27ae60;
            border-radius: 8px;
            padding: 5px 10px;
        }

        .item-value input {
            width: 70px;
            background: transparent;
            border: none;
            color: var(--input-text);
            font-size: 1.2rem;
            font-weight: bold;
            text-align: right;
            outline: none;
        }

        .item-value input::placeholder { color: #27ae60; }
        .item-value input:focus { background: var(--item-bg); border-radius: 5px; }

        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        button {
            padding: 15px 30px;
            font-size: 1rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .btn-check {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
        }

        .btn-check:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(39, 174, 96, 0.4);
        }

        .btn-new {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .btn-new:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(52, 152, 219, 0.4);
        }

        .btn-hint {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
        }

        .btn-hint:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(155, 89, 182, 0.4);
        }

        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.2rem;
            display: none;
        }

        .result.correct {
            background: rgba(39, 174, 96, 0.3);
            border: 2px solid #27ae60;
            display: block;
        }

        .result.wrong {
            background: rgba(231, 76, 60, 0.3);
            border: 2px solid #e74c3c;
            display: block;
        }

        .hint-box {
            margin-top: 20px;
            padding: 20px;
            background: rgba(155, 89, 182, 0.2);
            border: 2px solid #9b59b6;
            border-radius: 15px;
            display: none;
        }

        .hint-box.show { display: block; }

        .hint-title {
            color: #9b59b6;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .formula {
            font-family: 'Courier New', monospace;
            background: rgba(0,0,0,0.2);
            padding: 10px 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.95rem;
        }

        .equation-check {
            margin-top: 20px;
            padding: 15px;
            background: var(--card-bg);
            border-radius: 10px;
        }

        .equation-title {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 10px;
        }

        .equation-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .equation-row:last-child { border-bottom: none; }
        .equation-name { color: var(--text-secondary); font-size: 0.85rem; }

        .equation-status {
            font-weight: bold;
            padding: 3px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
        }

        .equation-status.balanced { background: rgba(39, 174, 96, 0.3); color: #2ecc71; }
        .equation-status.unbalanced { background: rgba(231, 76, 60, 0.3); color: #e74c3c; }

        .difficulty-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .difficulty-btn {
            padding: 8px 20px;
            background: var(--item-bg);
            border: 2px solid transparent;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .difficulty-btn.active {
            border-color: #27ae60;
            color: #27ae60;
            background: rgba(39, 174, 96, 0.1);
        }

        .difficulty-btn:hover { background: var(--card-bg-hover); }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .pulse { animation: pulse 0.5s ease-in-out; }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .shake { animation: shake 0.3s ease-in-out; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="index.html" class="back-btn">â† ë©”ì¸ìœ¼ë¡œ</a>
            <h1>âœï¸ ì£¼ê´€ì‹ ëª¨ë“œ</h1>
            <span class="mode-badge">ì§ì ‘ ì…ë ¥</span>
        </div>

        <div class="stats">
            <div class="stat">
                <div class="stat-value" id="score">0</div>
                <div class="stat-label">ì ìˆ˜</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="streak">0</div>
                <div class="stat-label">ì—°ì† ì •ë‹µ</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="total">0</div>
                <div class="stat-label">ì´ ë¬¸ì œ</div>
            </div>
        </div>

        <div class="difficulty-selector">
            <button class="difficulty-btn active" data-difficulty="easy">ì‰¬ì›€</button>
            <button class="difficulty-btn" data-difficulty="normal">ë³´í†µ</button>
            <button class="difficulty-btn" data-difficulty="hard">ì–´ë ¤ì›€</button>
        </div>

        <div class="energy-diagram">
            <div class="section">
                <div class="section-title solar">
                    <span class="icon">â˜€ï¸</span> íƒœì–‘ ë³µì‚¬ (ë‹¨íŒŒ)
                </div>
                <div class="items-grid">
                    <div class="item"><span class="item-name">íƒœì–‘ ë³µì‚¬ ì´ëŸ‰</span><span class="item-value" id="S"></span></div>
                    <div class="item"><span class="item-name">ëŒ€ê¸° ë°˜ì‚¬</span><span class="item-value" id="Ra"></span></div>
                    <div class="item"><span class="item-name">ì§€í‘œ ë°˜ì‚¬</span><span class="item-value" id="Rs"></span></div>
                    <div class="item"><span class="item-name">ëŒ€ê¸° í¡ìˆ˜</span><span class="item-value" id="Aa"></span></div>
                    <div class="item"><span class="item-name">ì§€í‘œ í¡ìˆ˜</span><span class="item-value" id="As"></span></div>
                </div>
            </div>

            <div class="section">
                <div class="section-title surface">
                    <span class="icon">ğŸŒ</span> ì§€í‘œ ì—ë„ˆì§€
                </div>
                <div class="items-grid">
                    <div class="item"><span class="item-name">ëŒ€ë¥˜Â·ì „ë„</span><span class="item-value" id="H"></span></div>
                    <div class="item"><span class="item-name">ì ì—´</span><span class="item-value" id="LE"></span></div>
                    <div class="item"><span class="item-name">ì§€í‘œ ë³µì‚¬</span><span class="item-value" id="Lup"></span></div>
                    <div class="item"><span class="item-name">ì§€í‘œâ†’ìš°ì£¼ ì§í–‰</span><span class="item-value" id="Lspace"></span></div>
                </div>
            </div>

            <div class="section">
                <div class="section-title atmosphere">
                    <span class="icon">ğŸŒ«ï¸</span> ëŒ€ê¸° ì—ë„ˆì§€
                </div>
                <div class="items-grid">
                    <div class="item"><span class="item-name">ëŒ€ê¸°â†’ìš°ì£¼ ë°©ì¶œ</span><span class="item-value" id="LaSpace"></span></div>
                    <div class="item"><span class="item-name">ëŒ€ê¸° ì¬ë³µì‚¬</span><span class="item-value" id="LaSfc"></span></div>
                </div>
            </div>
        </div>

        <div class="buttons">
            <button class="btn-check" onclick="checkAnswer()">ì •ë‹µ í™•ì¸</button>
            <button class="btn-hint" onclick="showHint()">íŒíŠ¸ ë³´ê¸°</button>
            <button class="btn-new" onclick="generateNewProblem()">ìƒˆ ë¬¸ì œ</button>
        </div>

        <div class="result" id="result"></div>

        <div class="hint-box" id="hintBox">
            <div class="hint-title">ğŸ’¡ íŒíŠ¸</div>
            <div id="hintContent"></div>
        </div>

        <div class="equation-check" id="equationCheck" style="display: none;">
            <div class="equation-title">ë³´ì¡´ì‹ ê²€ì¦</div>
            <div class="equation-row">
                <span class="equation-name">íƒœì–‘ ë¶„ë°°: S = Râ‚ + Râ‚› + Aâ‚ + Aâ‚›</span>
                <span class="equation-status" id="eq1Status">-</span>
            </div>
            <div class="equation-row">
                <span class="equation-name">ì§€í‘œ í‰í˜•: Aâ‚› + L(ëŒ€ê¸°â†’ì§€í‘œ) = Lâ†‘ + L(ìš°ì£¼) + H + LE</span>
                <span class="equation-status" id="eq2Status">-</span>
            </div>
            <div class="equation-row">
                <span class="equation-name">ëŒ€ê¸° í‰í˜•: Aâ‚ + Lâ†‘ + H + LE = L(ëŒ€ê¸°â†’ìš°ì£¼) + L(ëŒ€ê¸°â†’ì§€í‘œ)</span>
                <span class="equation-status" id="eq3Status">-</span>
            </div>
        </div>
    </div>

    <script src="core.js"></script>
    <script>
        // ê²Œì„ ìƒíƒœ
        let gameState = {
            score: 0,
            streak: 0,
            total: 0,
            difficulty: 'easy',
            currentProblem: null,
            unknownKey: null,
            correctAnswer: null
        };

        function generateNewProblem() {
            document.getElementById('hintBox').classList.remove('show');
            document.getElementById('result').className = 'result';
            document.getElementById('equationCheck').style.display = 'none';

            const data = generateBalancedDataset(gameState.difficulty);
            const verification = verifyConservation(data);

            if (!verification.solar || !verification.surface || !verification.atmosphere) {
                generateNewProblem();
                return;
            }

            const settings = difficultySettings[gameState.difficulty];
            const unknownKey = settings.unknownOptions[Math.floor(Math.random() * settings.unknownOptions.length)];

            gameState.currentProblem = { ...data };
            gameState.unknownKey = unknownKey;
            gameState.correctAnswer = data[unknownKey];

            renderProblem(data, unknownKey);
        }

        function renderProblem(data, unknownKey) {
            const keys = ['S', 'Ra', 'Rs', 'Aa', 'As', 'H', 'LE', 'Lup', 'Lspace', 'LaSpace', 'LaSfc'];

            keys.forEach(key => {
                const element = document.getElementById(key);
                if (key === unknownKey) {
                    element.innerHTML = `<input type="number" id="answer" placeholder="?" autofocus>`;
                    element.classList.add('unknown');
                } else {
                    element.textContent = data[key];
                    element.classList.remove('unknown');
                }
            });

            const answerInput = document.getElementById('answer');
            if (answerInput) {
                answerInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') checkAnswer();
                });
                answerInput.focus();
            }
        }

        function checkAnswer() {
            const answerInput = document.getElementById('answer');
            if (!answerInput) return;

            const userAnswer = parseInt(answerInput.value);

            if (isNaN(userAnswer)) {
                answerInput.classList.add('shake');
                setTimeout(() => answerInput.classList.remove('shake'), 300);
                return;
            }

            const resultDiv = document.getElementById('result');
            gameState.total++;

            if (userAnswer === gameState.correctAnswer) {
                gameState.streak++;
                gameState.score += 10 * gameState.streak;
                resultDiv.textContent = `ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤! (+${10 * gameState.streak}ì )`;
                resultDiv.className = 'result correct pulse';
            } else {
                gameState.streak = 0;
                resultDiv.textContent = `âŒ í‹€ë ¸ìŠµë‹ˆë‹¤. ì •ë‹µì€ ${gameState.correctAnswer}ì…ë‹ˆë‹¤.`;
                resultDiv.className = 'result wrong shake';
            }

            showEquationCheck();
            updateStats();
        }

        function showEquationCheck() {
            const equationCheck = document.getElementById('equationCheck');
            equationCheck.style.display = 'block';

            const data = { ...gameState.currentProblem };
            const answerInput = document.getElementById('answer');
            if (answerInput) {
                data[gameState.unknownKey] = parseInt(answerInput.value) || 0;
            }

            const verification = verifyConservation(data);

            document.getElementById('eq1Status').textContent = verification.solar ? 'ê· í˜• âœ“' : `ë¶ˆê· í˜• (${verification.residuals.solar > 0 ? '+' : ''}${verification.residuals.solar})`;
            document.getElementById('eq1Status').className = `equation-status ${verification.solar ? 'balanced' : 'unbalanced'}`;

            document.getElementById('eq2Status').textContent = verification.surface ? 'ê· í˜• âœ“' : `ë¶ˆê· í˜• (${verification.residuals.surface > 0 ? '+' : ''}${verification.residuals.surface})`;
            document.getElementById('eq2Status').className = `equation-status ${verification.surface ? 'balanced' : 'unbalanced'}`;

            document.getElementById('eq3Status').textContent = verification.atmosphere ? 'ê· í˜• âœ“' : `ë¶ˆê· í˜• (${verification.residuals.atmosphere > 0 ? '+' : ''}${verification.residuals.atmosphere})`;
            document.getElementById('eq3Status').className = `equation-status ${verification.atmosphere ? 'balanced' : 'unbalanced'}`;
        }

        function showHint() {
            const hintBox = document.getElementById('hintBox');
            const hintContent = document.getElementById('hintContent');
            const hint = hintFormulas[gameState.unknownKey];

            if (hint) {
                hintContent.innerHTML = `<p>${hint.explanation}</p><div class="formula">${hint.equation}</div>`;
            } else {
                hintContent.innerHTML = '<p>ì—ë„ˆì§€ ë³´ì¡´ ë²•ì¹™ì„ ì´ìš©í•´ë³´ì„¸ìš”!</p>';
            }

            hintBox.classList.add('show');
        }

        function updateStats() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('streak').textContent = gameState.streak;
            document.getElementById('total').textContent = gameState.total;
        }

        function setDifficulty(difficulty) {
            gameState.difficulty = difficulty;
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.difficulty === difficulty);
            });
            generateNewProblem();
        }

        document.querySelectorAll('.difficulty-btn').forEach(btn => {
            btn.addEventListener('click', () => setDifficulty(btn.dataset.difficulty));
        });

        generateNewProblem();
    </script>
</body>
</html>
